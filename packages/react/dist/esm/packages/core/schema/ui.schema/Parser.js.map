{"version":3,"file":"Parser.js","sources":["../../../../../../../core/schema/ui.schema/Parser.ts"],"sourcesContent":["import orderBy from 'lodash/orderBy';\n\nimport { FieldsetNode, UiSchema } from '../../models/UiSchema';\nimport { UiStore } from './UiStore';\n\nexport class UiSchemaParser {\n  private counter = 0;\n\n  store!: UiStore;\n\n  constructor() {\n    this.store = new UiStore();\n  }\n\n  // reconsider:\n  // Do I need to prepare the tree in ahead-of-time?\n  // can the child nodes be derived just-in-time?\n  private traverse(uiSchema: UiSchema | FieldsetNode, idRoot: string) {\n    const nextCount = ++this.counter;\n    const id = idRoot + '/' + (uiSchema.id ?? nextCount);\n\n    this.store.keyMap[id] = uiSchema;\n\n    if (!('nodes' in uiSchema)) return id;\n\n    const treeNodes: string[] = [];\n\n    const nodes = (uiSchema as FieldsetNode).nodes.filter(Boolean);\n    for (const nextUiSchema of nodes) {\n      treeNodes.push(this.traverse(nextUiSchema, id));\n    }\n\n    this.store.tree[id] = orderBy(\n      treeNodes,\n      (nodeId) => this.store.keyMap[nodeId].id ?? 0,\n      'asc'\n    );\n\n    return id;\n  }\n\n  static parse(uiSchema: UiSchema) {\n    const ClassConstructor: typeof UiSchemaParser = Object.assign(this);\n    const parser = new ClassConstructor();\n\n    const id = parser.traverse(uiSchema, 'root');\n\n    parser.store.setRoot(id);\n    const store = parser.store;\n\n    return new Proxy(store, {\n      get(target, key, receiver) {\n        return Reflect.get(target, key, receiver);\n      },\n    });\n  }\n}\n"],"names":["UiSchemaParser","__publicField","UiStore","uiSchema","idRoot","nextCount","id","treeNodes","nodes","nextUiSchema","orderBy","nodeId","ClassConstructor","parser","store","target","key","receiver"],"mappings":"uSAKO,MAAMA,CAAe,CAK1B,aAAc,CAJNC,EAAA,eAAU,GAElBA,EAAA,cAGO,KAAA,MAAQ,IAAIC,CACnB,CAKQ,SAASC,EAAmCC,EAAgB,CAC5D,MAAAC,EAAY,EAAE,KAAK,QACnBC,EAAKF,EAAS,KAAOD,EAAS,IAAME,GAItC,GAFC,KAAA,MAAM,OAAOC,CAAE,EAAIH,EAEpB,EAAE,UAAWA,GAAkB,OAAAG,EAEnC,MAAMC,EAAsB,CAAA,EAEtBC,EAASL,EAA0B,MAAM,OAAO,OAAO,EAC7D,UAAWM,KAAgBD,EACzBD,EAAU,KAAK,KAAK,SAASE,EAAcH,CAAE,CAAC,EAG3C,YAAA,MAAM,KAAKA,CAAE,EAAII,EACpBH,EACCI,GAAW,KAAK,MAAM,OAAOA,CAAM,EAAE,IAAM,EAC5C,KAAA,EAGKL,CACT,CAEA,OAAO,MAAMH,EAAoB,CACzB,MAAAS,EAA0C,OAAO,OAAO,IAAI,EAC5DC,EAAS,IAAID,EAEbN,EAAKO,EAAO,SAASV,EAAU,MAAM,EAEpCU,EAAA,MAAM,QAAQP,CAAE,EACvB,MAAMQ,EAAQD,EAAO,MAEd,OAAA,IAAI,MAAMC,EAAO,CACtB,IAAIC,EAAQC,EAAKC,EAAU,CACzB,OAAO,QAAQ,IAAIF,EAAQC,EAAKC,CAAQ,CAC1C,CAAA,CACD,CACH,CACF"}